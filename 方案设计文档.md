# **方案设计文档**

> @author：徐浩
>
> @date：2022.05.22
>
> @version：1.0



# 任务需求

## 方案需求

本文档对应的QQ频道机器人名为“QRobot”，昵称为“小Q”。

预期实现在频道内用户与小Q进行成语接龙的功能，具体表现为：用户@小Q并发送特定消息，小Q收到后开启游戏，并给用户发送第一个成语；用户收到后需给出自己的答案，给出的答案错误，提示用户答案不正确，游戏结束；用户给出的答案正确，小Q搜寻给出自己的答案，若找不到答案则判定用户赢。

## 运行环境

```
ubuntu 18.04
python 3.19
Visual Studio Code 2019（远程）
```

## 数据描述

### IO数据

> 输入：
>
> - 用户开始游戏的关键词，如“/接龙”
> - 用户游戏过程中输入的成语
> - 用户希望结束游戏的关键词，如“不玩了”
>
> 输出：
>
> - 对用户操作的提示信息，如提示游戏开始
> - 对用户输入成语的回复

### 数据词典

> github上开源的中华成语库，地址为：https://[github](https://so.csdn.net/so/search?q=github&spm=1001.2101.3001.7020).com/pwxcoo/chinese-xinhua
>
> 程序中采用下载到本地的方式加快查询速度

## 功能需求

- 配置频道机器人小Q的AppID等信息
- 处理用户输入和结果输出
- 根据输入判断当前需要进行的操作



# 总体设计

## 模块划分

根据预期实现的功能，主体部分可分为：文件配置模块、IO处理模块和逻辑处理模块三部分，它们的功能分别为：

- 文件配置模块：包含频道机器人的BotAPPID和Bot token，均为字符串格式；
- IO处理模块：
  - 读取用户输入，包含开启和结束成语接龙游戏的关键词，以及游戏过程中用户给出的答案；
  - 输出信息，包含对用户输入的提示信息，以及接龙游戏过程中对用户答案的应答；
- 逻辑处理模块：
  - 状态记录：记录当前游戏状态（开始/未开始）；
  - 逻辑判断：根据用户输入和当前游戏状态判断下一步要处理的逻辑。

在上述三部分中，文件配置模块和逻辑处理模块均遵循频道机器人开发框架进行程序编写，下面重点介绍逻辑处理模块。

## 逻辑处理

根据上述分析，程序处理逻辑的依据主要是两部分：用户输入内容和当前游戏状态。在程序中可用content和is_begin变量来表示，其中content是字符串类型，表示收到的用户发送的内容；is_begin为布尔类型，表示在收到这条消息之前，游戏是否已经开始。

程序逻辑实现如下：

![image-20220522204648961](C:\Users\22867\AppData\Roaming\Typora\typora-user-images\image-20220522204648961.png)

## 接口设计

- 传入接口：
  - 配置文件config.yaml中需要用户输入频道机器人的BotAPPID、Bot token信息；
  - 用户的消息输入，如开始游戏的指令“/接龙”、输入的成语；
- 传出接口
  - 对用户操作的提示信息，如输入指令非法、输入成语正确等

## 测试要点

需要测试以下几种情况：

- 正常开始输入：“/接龙”，测试机器人是否输出游戏开始的提示，并给出第一个成语
- 开始后重新输入开始指令“/接龙”：测试机器人是否输出游戏已经开始过了，提示用户继续对已经给出的成语进行接龙
- 开始后输入正确的答案A：测试机器人是否提示回答正确，并给出对A成语的回复B，或提示自己回答不上来，用户赢得游戏
- 开始后输入错误答案：测试机器人是否提示回答错误，并结束游戏
- 开始后输入非成语的答案：测试机器人是否提示用户输入的不是成语，需要重新输入
- 开始前输入任意非开始指令的字符：测试机器人是否提示输入问题，要求重新输入